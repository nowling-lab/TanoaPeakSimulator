import argparse
import os

from caller import call_peaks_calculus

def do_call_peaks(args):
    """
    Checks the arguments and calls the calls peaks method within the caller directory
    :params args: the arguments given from argparse, depth-file and outputdir
    """
    if not os.path.exists(args.outputdir):
      os.makedirs(args.outputdir)

    if args.depth_file is None:
        print("Path specified to depth file is invalid")
        return
    calculation_style = "Conceptual" 
    if args.cal_style == 1:
        calculation_style = "Calculus"
    call_peaks_calculus(args.depth_file, args.outputdir, calculation_style, args.write_depths)

def parseargs():
    """
    generates and returns a namespace for the argument parser
    """
    parser = argparse.ArgumentParser(description="Caller")

    parser.add_argument("--depth-file",
                        type=str,
                        required=True,
                        help="Depth File with in chromosome,position,reads format")

    parser.add_argument("--outputdir",
                        type=str,
                        required=True,
                        help="Output file directory")
    
    parser.add_argument("--cal-style",
                        type=int,
                        required=False,
                        default=2,
                        help="Calculus or Conceptual. Use 1 for Calculus, or 2 for Conceptual." +
                        " Calculus uses first and second order derivatives to calculate peaks while " + 
                        " Conceptual registers the trend of the depth file and uses that to generate peaks" +
                        " Conceptual is more accurate, and is the default")

    parser.add_argument("--write-depths",
                        type=bool,
                        required=False,
                        default=False,
                        help="Prints the depth file after compression for troubleshooting or curiosity")

    return parser.parse_args()

if __name__ == "__main__":
    args = parseargs()
    do_call_peaks(args)